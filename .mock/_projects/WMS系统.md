# WMS 系统

wms 仓库管理系统, 负责库存调度， 本质解决的 仓库库存 到哪里去的问题

最终被操作的实体是 库存

## 基础数据

仓库：一个较大的物理区域的概念，涉及到整个区域的物流规划和管理，如北京仓、上海仓
库区：一个具体的建筑物或设施，根据物理布局，ASRS 库、PS 库
子仓：物理隔离的区域，目前一般是按照搬运设备类型进行区分，如 PS 子仓、AGV 子仓、CTU 子仓
区域：
逻辑区（按照业务逻辑对一组货位的逻辑划分），
缓存区（为了提高入出库效率，在靠近自动化设备库入出库口划分的一片区域）
存储区（对库区存储类型的定义，具体划分取决于客户的管理方式），
暂存区（一片用于临时存放货物的区域，根据使用场景的不同划分收货暂存和发货暂存）
月台：仓库或配送中心相连的装载和卸载货物的平台
站点：设备或容器可以停靠进行作业的位置，根据处理业务的不同可以分为：入库站点、出库站点、盘点站点等
容器：用于装载、保护和运输货物的各种类型的器具，如果需要系统管理则每个容器需要有可唯一标识的容器编码；常用的容器类型有：周转箱、纸箱、笼车、托盘等
条码：由一组规则排列的条、空及其对应字符组成的，用以表示一定信息的标识，根据使用场景不同可能存在的条码用：货位、物料、容器等
货位地址: 一组编码用于区分不同的物理货位，可以根据客户需求定义编码规则; 比如两位库区号+三位货架号+两位列号+两位层号
SKU：Stock Keeping Unit ，库存量单位，代表系统中每一个产品或物料唯一识别码，用于区分不同的物料种类(品项)，一般与物料编码一一对应
物料：指材料和原料，包括原材料、成品、半成品及辅助物品等。
计量单位：件，箱
单据：ERP/SAP 等上游系统与 WMS 之间传递的入出库订单维度的数据，用户的原始订单
任务单：WMS 与各子仓之间传递的处理后的订单数据，WMS 对单据进行聚合汇总处理后传递给各子仓的物料编码、数量等信息

## PC 系统功能

### 入库

### 出库

### 库内

- 库存

- 理货

### 盘点

### 辅助功能

## PDA 系统功能

同理

# 产品梳理

主要以报表业务为主，系统 80% 都是报表查询类逻辑

如何提效？

## 自定义报表生成器

背景：由于定制化项目客户要求可能各部相同，同一个标准品的页面, a 客户需要查询的字段是 3 个，b 客户是 2 个；
基于此背景，将需要前端定制化开发的一些场景抽象为可复用的产品功能，降低后续前端层面的开发成本

报表页面的结构特性：
UI 层： 1.查询表单 2.表格展示 3.自定义业务逻辑封装嵌入

事件交互层：
点击表单查询，表格接受参数提交接口进行查询

设计实现： 1.报表页面配置 （数据字段配置来源， sql 语句）

- 根据 SQL 语句获取所有的配置字段
- 对字段进行业务分类，主要分为两大类
  ---- 查询表单
  -------- 定义字段表单类型（input，select，timepicker 等）
  -------- 如果是 select 还需要配置下拉数据源等
  -------- 如果是 input，是模糊搜索，还是精确搜索等
  ---- 表格展示
  -------- 定义字段业务逻辑（是否合计）

  2.配置完成后，落库； 如果需要在系统里渲染；则需要发布到指定的菜单下面，且配置权限
  初始化系统的时候，生成动态路由插入到前端路由表里

  3.配置渲染
  开发一个独立组件： 负责读取配置 =》 解析表单和表格各字段属性 =》传入到组件
  然后生成表单组件 和 表格组件
  QueryForm =》 initPageForm
  QueryTable =》 initPageTable
  =》 组成 queryPage

## 自定义流程

将实际业务流程中每一个功能节点进行模块化，通过对同一业务各功能节点的自由组合，定制一个特殊的业务流程，满足不同行业/客户的不同业务流程需求，
在一定程度上减少项目实施过程的定制开发，降低开发成本，提高项目实施效率。

- 入库流程业务功能节点
  入库单创建，收货，质检，组盘，自动化库分配货位，非自动化库分配货位，上架

- 出库流程业务功能节点
  出库单创建，生成波次，分配库存，是否自动拣选（自动拣货， 人工拣选），出库确认（集货复核）

- 盘点流程
  盘点单， 开始盘点，盘点结果，复盘，损益处理

- 库内流程
  容器移位
  理货，
  补货，

### 前端实现

将需要后端定制化开发的一些场景转换为 通过前端节点的组合来完成，降低后期后端层面的开发成本；
只需要在前端流程图组装 业务功能节点， 就可以在后台生成一条任务执行流水线；执行流程上逻辑编排

需要将业务流程中每一个功能节点进行高度抽象模块化，通过对同一业务各功能节点的自由组合，定制一个特殊的业务流程；
目的是 把后端的业务流程执行逻辑代码块 放在 前端自由排列组合； 降低项目定制化开发成本；

流程图组成结构：节点 + 边
逻辑结构：顺序结构， 分支结构

UI 和产品设计不适用编辑器拖拽映射，从上往下，左往右平铺的方式

节点数据建模

### 遇到的问题

扩展性问题，后期扩展延迟选择节点的时候 重新设计

```js
// 重构前的node数据属性
const data = {
  branchStartPos: "",
  condition: 0,
  conditionInput: 1,
  error: false,
  executeNormalStoresFlag: 0,
  executeParentStoresFlag: 0,
  executeThisStoresFlag: 0,
  fromNodePosList: [],

  logicFlag: 0,
  nodeAlias: "是否验收",
  nodeId: 3,
  nodeName: "是否验收",
  nodeType: "20",
  pos: "1.1",
  remark: "5555",
  ruleType: 0,
  status: "",
  toNodePosList: ["2.0", "2.3"],

  isCopy: false,
  height: 60,
  width: 205,
  x: 250,
  y: 108,
};

// 重构后的的node数据属性
const newNodeData = {
  // 必传属性
  pos: "", // uuid生成，节点唯一值
  fromNodePosList: [], // pos值，上一个相邻节点
  toNodePosList: [""], // pos值，下一个相邻节点
  nodeType: 10, // 节点类型 10,20,30=业务节点，条件节点，延迟节点
  nodeId: 1, // 节点列表中的 nodeId
  nodeAlias: "xxxx", // 节点别名
  executeNormalStoresFlag: 0,
  executeParentStoresFlag: 0,
  executeThisStoresFlag: 0,
  ruleId: "12", // 配置的规则id
  remark: "hello", // 备注
  // 重构后变动的属性，去掉conditionInput，不用这个查找执行路径
  // 条件节点 增加两个属性用于 维护后端追溯到下一个可执行节点
  toYesPos: "", // uuid生成，节点唯一值
  toNoPos: "", // uuid生成，节点唯一值
};

// 新增编辑提交 平铺的节点列表给后端
```

### 设计实现 1

基于 svg 实现：（曲线边）

节点二维矩阵化来描述布局， 设计节点坐标，边跟进相邻节点坐标来相连

### 设计实现 2

- 节点的布局
  全部是根据 display:flex; 居中来进行插入元素；
  不需要进行坐标计算， 直接按 div 标准流进行 自适应布局。
  插入的节点都是插入到总数据的 child 子节点数组中，渲染也是基于递归组件进行渲染，css 会自动进行样式居中。

遍历节点数组，跟进节点类型和动态组件 is 来渲染具体节点

数据模型：
嵌套数据，初始化一个两个节点的数组；
新增业务节点在中间插入一个节点；
新增分支选择节点，也是插入一个节点（携带 children 数组，内含两个业务节点），最顶上的是分支头结点；
在分支下插入新节点会被算作该节点的兄弟节点，放在其 nodelist 里维护；

新增多分支节点，同理

每一个节点在 UI 上占一层；

- 边：
  通过 css 伪类元素:after 和:before 进行绝对定位实现连线，以及通过 border 边框配合定位元素进行颜色抵消，来实现

## 自定义 web 打印编辑器工具

需求背景：项目交付中经常会碰到各种单据打印需求，箱码，条码等 贴在纸箱和周转箱上这种业务，且每个客户提供打印模版不太一样，所有每个项目都定制化开发， 为了解决这个问题就开发了这个打印模版编辑器，提高人效，并支持个性化自定义模版，满足 90%以上的需求

- 主动触发的打印
- 自动打印(依赖 exe 程序)

大概梳理下目前需要实现的核心功能点（重难点）
1.DOM 元素 拖拽控制
2.DOM 元素 结构控制（增删改）
3.JSON 结构解析和编译 HTML《=》JSON 互转  
4.打印文档生成， 适配打印机  
5.编辑器交互操作设计 （事件系统）  
6.打印方案动态挂载到目标页面

被控制的元素物料：文字，图片，表格，二维码，条形码，基础图形（线，矩形，圆），字段列

### 架构设计

由于打印的元素类型 和 渲染数量并不多

直接基于 DOM 实现，主要是封装组件，以功能实现为主

MVC 模式
编辑物料准备区（业务元素），编辑控制状态（业务控件区）， 元素面板信息展示区

代码实现： 物料单元数组 + 动态组件渲染

生成一个打印配置文件， 在哪应用呢？ 从报表页面 取数， 对模版进行填充

### 难点

1.实现方案采用：
web 端无感知打印 + 打印机静默打印
web 端采用 iframe，静默打印开发一个本地应用程序来实现

2.打印内容分页处理
当打印模版里存在 table 时，
表格元素数据填充后长度是不定长的，我们的纸张尺寸是定宽高的，需要做各种场景做处理

3.表格实体模型的设计：需要支持合并单元格 和 拆分单元格，插入行，插入列
选中单元格的实现：
mousedown 选中 + mouseover（为什么没有用 mousemove 适合拖拽交互）+ mouseup 离开此次交互；
`mouseenter：当鼠标指针进入元素边界时触发，与 mouseover 不同的是，它不会冒泡，且不会在子元素上触发`
mouseover 的过程中给单元格添加 selected 标识

```js
// 表格是有行，列特征；我们直接用一个 二维矩阵模型来表示表格的结构
// 普通单元格设置为0，
// 表格自带合并属性 rowSpan colSpan

// 合并后会形成一个大单元格
// 合并的起始格定位-负数开头，被合并的格子定为取反，这样就是一组单元格

// 收集所有合并的单元格
// 拆封单元格， 获取开始的单元格，重写二维矩阵，重新生成表格

```

## 自定义大屏设计器

代码实现： 物料单元数组 + 动态组件渲染

拖拽生成布局信息；

物料属性面板配置物料展形式 和 数据来源等

解析编辑存储的配置文件，渲染出来

### 编辑的元素（物料）

布局模版，画布模版；
各类图形，echarts 图形单元封装
文字（跑马灯），表格；
视频，图标，图片；
个性化装饰素材；

数据模型定义 + 属性编辑

物料单元数组 + 动态组件渲染
